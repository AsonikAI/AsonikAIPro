<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asonik AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .message-box {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
    </style>
    <!-- Icons for social sign-in buttons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex flex-col min-h-screen">

    <!-- Header / Navigation -->
    <header class="bg-white dark:bg-gray-800 shadow-md p-4 w-full fixed top-0 left-0 z-50">
        <div class="flex justify-between items-center max-w-7xl mx-auto">
            <h1 class="text-xl md:text-2xl font-bold text-indigo-600 dark:text-indigo-400">
                Asonik AI
            </h1>
            <div id="auth-info" class="flex items-center space-x-4">
                <!-- User profile info will be rendered here dynamically -->
            </div>
        </div>
    </header>

    <!-- Main content area -->
    <main class="flex-grow pt-20 pb-20 p-4 overflow-y-auto">
        <div id="main-content" class="flex flex-col items-center justify-center min-h-full">
            <!-- Dynamic content will be loaded here -->
        </div>
    </main>
    
    <!-- Chat Input Section -->
    <div id="chat-input-section" class="bg-white dark:bg-gray-800 shadow-lg p-4 w-full fixed bottom-0 left-0 z-50 transition-transform transform translate-y-full hidden md:flex md:translate-y-0 items-center justify-center">
        <div class="flex items-center w-full max-w-3xl">
            <input type="text" id="chat-input" placeholder="Отправьте сообщение..." class="flex-grow p-3 rounded-full border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 mr-2">
            <button id="send-button" class="p-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
            </button>
            <button id="upload-button" class="p-3 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-gray-200 rounded-full hover:bg-gray-400 dark:hover:bg-gray-500 transition duration-300 ml-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
            </button>
        </div>
    </div>
    
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            GoogleAuthProvider,
            EmailAuthProvider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            signInWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables
        let app, db, auth;

        // Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1FLSf6PBzNzb7_CWYH6Y0_--jhqO9MLQ",
            authDomain: "asonik-ai.firebaseapp.com",
            projectId: "asonik-ai",
            storageBucket: "asonik-ai.firebasestorage.app",
            messagingSenderId: "875716508614",
            appId: "1:875716508614:web:ad264fdd60a20eb7dd90c7",
            measurementId: "G-HT5T20YPVE"
        };
        
        // Message Box function (for non-working buttons)
        const showMessage = (message) => {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box p-4 bg-white dark:bg-gray-800 rounded-lg shadow-xl text-gray-900 dark:text-gray-100';
            messageBox.textContent = message;
            document.body.appendChild(messageBox);
            setTimeout(() => {
                messageBox.remove();
            }, 3000);
        };

        // Render functions
        const renderHeader = (user) => {
            const authInfoDiv = document.getElementById('auth-info');
            if (!authInfoDiv) return;
            
            if (user) {
                // User is signed in
                const userDisplayName = user.displayName || 'Профиль';
                const userPhotoURL = user.photoURL || '';
                authInfoDiv.innerHTML = `
                    <div class="flex items-center space-x-2 cursor-pointer group relative">
                        ${userPhotoURL ? `<img src="${userPhotoURL}" alt="Profile" class="w-8 h-8 rounded-full ring-2 ring-indigo-500 dark:ring-indigo-300">` : ''}
                        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300 hidden md:block">${userDisplayName}</span>
                        <div class="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg py-2 hidden group-hover:block">
                            <p class="px-4 py-2 text-sm font-medium text-gray-800 dark:text-gray-200">${user.email || 'Нет Email'}</p>
                            <button id="signOutButton" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 transition duration-200">
                                Выйти
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('signOutButton').addEventListener('click', () => {
                    signOut(auth).catch(error => console.error("Sign-Out Error:", error));
                });
            } else {
                // User is signed out
                authInfoDiv.innerHTML = `
                    <button id="googleSignInButtonHeader" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition duration-300 shadow-md">
                        Войти
                    </button>
                `;
                document.getElementById('googleSignInButtonHeader').addEventListener('click', async () => {
                    const provider = new GoogleAuthProvider();
                    try {
                        await signInWithPopup(auth, provider);
                    } catch (error) {
                        console.error("Google Sign-In Error:", error);
                    }
                });
            }
        };

        const renderMainContent = (user) => {
            const mainContentDiv = document.getElementById('main-content');
            const chatSection = document.getElementById('chat-input-section');
            if (!mainContentDiv || !chatSection) return;

            if (user) {
                // After sign in, show the AI selection hub
                mainContentDiv.innerHTML = `
                    <div class="flex flex-col items-center w-full max-w-lg">
                        <p class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-200">Выберите AI-модель</p>
                        <button id="asonikAiButton" class="w-full px-6 py-4 bg-green-500 text-white font-semibold rounded-2xl hover:bg-green-600 transition duration-300 shadow-lg mb-4 text-left">
                            <span class="text-lg">Asonik AI</span><br>
                            <span class="text-sm">В разработке</span>
                        </button>
                        <button id="geminiButton" class="w-full px-6 py-4 bg-blue-500 text-white font-semibold rounded-2xl hover:bg-blue-600 transition duration-300 shadow-lg mb-4 text-left">
                            <span class="text-lg">Gemini</span><br>
                            <span class="text-sm">В разработке</span>
                        </button>
                        <button id="otherButton" class="w-full px-6 py-4 bg-yellow-500 text-white font-semibold rounded-2xl hover:bg-yellow-600 transition duration-300 shadow-lg text-left">
                            <span class="text-lg">Другие AI-модели</span><br>
                            <span class="text-sm">Скоро...</span>
                        </button>
                    </div>
                `;
                chatSection.classList.add('hidden'); // Hide chat input on selection page
            } else {
                // Before sign in, show the login options
                mainContentDiv.innerHTML = `
                    <div class="flex flex-col items-center w-full max-w-lg">
                        <p class="text-lg mb-6 text-gray-600 dark:text-gray-400">
                            Войдите, чтобы получить доступ к различным AI-моделям.
                        </p>
                        <div class="flex flex-col space-y-4 w-full" id="auth-buttons-container">
                            <button id="googleSignInButtonFull" class="w-full px-6 py-3 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-300 shadow-lg flex items-center justify-center">
                                <svg class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12.0001 4.75001C14.0084 4.75001 15.8202 5.4856 17.2003 6.78653L20.0337 3.95319C17.9377 2.01633 15.1107 0.999998 12.0001 0.999998C7.62537 0.999998 3.86146 3.40058 1.93375 7.15197L5.61793 9.99222C6.54922 8.35821 8.16782 7.25001 10.0001 7.25001C10.6698 7.25001 11.3195 7.35628 11.9333 7.56191L12.0001 7.58552V4.75001Z" />
                                    <path d="M22.0001 12.0001C22.0001 11.107 21.8797 10.2526 21.657 9.45899H12.0001V14.5412H18.7845C18.4283 16.3242 17.3093 17.8018 15.756 18.788L19.4633 21.6033C20.6722 19.8973 21.5001 17.8073 21.8906 15.5833H21.9991C22.0001 15.0601 22.0001 12.0001 22.0001 12.0001Z" />
                                    <path d="M10.0001 16.75C8.16782 16.75 6.54922 15.6418 5.61793 14.0078L1.93375 16.8481C3.86146 20.5995 7.62537 23.0001 12.0001 23.0001C15.1107 23.0001 17.9377 21.9837 20.0337 20.0469L17.2003 17.2135C15.8202 18.5144 14.0084 19.25 12.0001 19.25C10.6698 19.25 10.0001 19.25 10.0001 19.25C8.16782 19.25 6.54922 18.1418 5.61793 16.0078L1.93375 18.8481L5.61793 21.6883C6.54922 23.3223 8.16782 24.4305 10.0001 24.4305C10.6698 24.4305 11.3195 24.3242 11.9333 24.1186L12.0001 24.0949C12.0001 24.0949 12.0001 24.0949 12.0001 24.0949Z" />
                                    <path d="M12.0001 16.75V24.0949C12.0001 24.0949 12.0001 24.0949 12.0001 24.0949Z" />
                                    <path d="M12.0001 7.25001C11.3304 7.25001 10.6807 7.14374 10.0669 6.93811L10.0001 6.9145V14.5412H21.657C21.8797 13.7475 22.0001 12.8931 22.0001 12.0001C22.0001 11.107 21.8797 10.2526 21.657 9.45899H12.0001V4.75001H12.0001Z" />
                                </svg>
                                Войти с Google
                            </button>
                            <button id="emailSignInButton" class="w-full px-6 py-3 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-300 shadow-lg flex items-center justify-center">
                                <i class="fas fa-envelope fa-lg mr-3"></i>
                                Войти с помощью почты
                            </button>
                            <button id="phoneSignInButton" class="w-full px-6 py-3 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-300 shadow-lg flex items-center justify-center">
                                <i class="fas fa-phone fa-lg mr-3"></i>
                                Войти с помощью телефона
                            </button>
                        </div>
                    </div>
                `;
                chatSection.classList.add('hidden'); // Hide chat input before sign in
                
                // Add click listeners for social buttons
                document.getElementById('googleSignInButtonFull').addEventListener('click', async () => {
                    const provider = new GoogleAuthProvider();
                    try {
                        await signInWithPopup(auth, provider);
                    } catch (error) {
                        console.error("Google Sign-In Error:", error);
                    }
                });
                document.getElementById('emailSignInButton').addEventListener('click', () => {
                    // Render the email/password form
                    renderEmailForm();
                });
                document.getElementById('phoneSignInButton').addEventListener('click', () => {
                    // Render the phone sign-in form
                    renderPhoneForm();
                });
            }
        };

        const renderEmailForm = () => {
             const mainContentDiv = document.getElementById('main-content');
             mainContentDiv.innerHTML = `
                <div class="flex flex-col items-center w-full max-w-lg">
                    <p class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-200">Вход с помощью почты</p>
                    <input type="email" id="emailInput" placeholder="Введите почту" class="w-full p-3 mb-4 rounded-full border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="password" id="passwordInput" placeholder="Введите пароль" class="w-full p-3 mb-6 rounded-full border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button id="signInWithEmailButton" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition duration-300 shadow-lg">
                        Войти
                    </button>
                    <button id="backToSignInOptions" class="mt-4 w-full px-6 py-3 bg-gray-300 text-gray-800 font-semibold rounded-full hover:bg-gray-400 transition duration-300">
                        Назад к вариантам входа
                    </button>
                </div>
            `;
            document.getElementById('signInWithEmailButton').addEventListener('click', async () => {
                const email = document.getElementById('emailInput').value;
                const password = document.getElementById('passwordInput').value;
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error("Email Sign-In Error:", error);
                    showMessage(error.message);
                }
            });
            document.getElementById('backToSignInOptions').addEventListener('click', () => {
                onAuthStateChanged(auth, renderUI);
            });
        };

        const renderPhoneForm = () => {
             const mainContentDiv = document.getElementById('main-content');
             mainContentDiv.innerHTML = `
                <div class="flex flex-col items-center w-full max-w-lg">
                    <p class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-200">Вход с помощью телефона</p>
                    <input type="tel" id="phoneInput" placeholder="Введите номер телефона" class="w-full p-3 mb-6 rounded-full border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button id="sendPhoneCodeButton" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition duration-300 shadow-lg">
                        Отправить код
                    </button>
                    <button id="backToSignInOptions" class="mt-4 w-full px-6 py-3 bg-gray-300 text-gray-800 font-semibold rounded-full hover:bg-gray-400 transition duration-300">
                        Назад к вариантам входа
                    </button>
                </div>
            `;
            document.getElementById('sendPhoneCodeButton').addEventListener('click', () => {
                showMessage("Вход с помощью телефона пока в разработке.");
            });
            document.getElementById('backToSignInOptions').addEventListener('click', () => {
                onAuthStateChanged(auth, renderUI);
            });
        };

        const renderChatPage = (user) => {
            const mainContentDiv = document.getElementById('main-content');
            const chatSection = document.getElementById('chat-input-section');
            if (!mainContentDiv || !chatSection) return;
            mainContentDiv.innerHTML = `
                <div class="w-full max-w-3xl flex flex-col space-y-4 p-4">
                    <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-xl shadow-md">
                        <p class="text-sm font-semibold text-gray-800 dark:text-gray-200">Asonik AI</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Все функции находятся в разработке. Скоро будет доступно.</p>
                    </div>
                    <!-- Chat messages will be dynamically added here -->
                </div>
            `;
            chatSection.classList.remove('hidden'); // Show chat input on chat page
        };
        
        // This is a new wrapper function to handle the onAuthStateChanged listener
        const renderUI = (user) => {
            renderHeader(user);
            if (user) {
                renderMainContent(user);
            } else {
                renderMainContent(user);
            }
        };

        // Main logic to initialize Firebase and handle auth state
        window.onload = async () => {
            try {
                // Initialize Firebase
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Set up a listener for auth state changes
                onAuthStateChanged(auth, renderUI);

            } catch (error) {
                console.error("Failed to initialize Firebase:", error);
                const mainContentDiv = document.getElementById('main-content');
                if (mainContentDiv) {
                    mainContentDiv.innerHTML = `
                        <p class="text-red-500 font-semibold">
                            Ошибка инициализации Firebase. Пожалуйста, проверьте консоль.
                        </p>
                    `;
                }
            }
        };
    </script>
</body>
</html>
